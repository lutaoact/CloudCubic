<div class="container">
  <form class="form-horizontal media" name="form" role="form">
    <div class="media-object pull-right">
      <label class="thumbnail"
             ng-disabled="uploading.thumb">
        <input type="file" style="display:none;"
               ng-file-select="onThumbSelect($files)"/>
        <img qiniu-key="lecture.thumbnail"
             suffix="?imageView2/2/w/210/h/140"
             ng-show="!uploading.thumb"
             src="/assets/images/empty.jpg"/>
        <span ng-if="uploading.thumb">
          <i class="fa fa-spinner fa-spin"></i>上传中 {{uploadProgress.thumb}}
        </span>
      </label>
    </div>
    <div class="media-body">
      <div class="form-group">
        <div class="col-sm-2 control-label">
          <label for="lecture-name">课时名称</label>
        </div>
        <div class="col-sm-10">
          <input class="form-control"
                 id="lecture-name"
                 name="name"
                 ng-model="lecture.name"
                 placeholder="课时名称"
                 required>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-2 control-label">
          <label for="lecture-info">课时信息</label>
        </div>
        <div class="col-sm-10">
          <textarea class="form-control"
                    id="lecture-info"
                    name="info"
                    rows="2"
                    ng-model="lecture.info"
                    placeholder="课时信息">
          </textarea>
        </div>
      </div>

      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <label class="btn btn-default"
                 ng-disabled="uploading.ppt">
            <input type="file"
                   style="display:none;"
                   ng-file-select="onPPTSelect($files)"/>
            <span ng-if="uploading.ppt">
              <i class="fa fa-spinner fa-spin"></i>
              {{uploadProgress.ppt}}
            </span>
            导入PPT
          </label>

          <label class="btn btn-default"
                 ng-disabled="uploading.images">
            <input type="file" style="display:none;"
                   ng-file-select="onImagesSelect($files)"
                   multiple/>
            <span ng-if="uploading.images">
              <i class="fa fa-spinner fa-spin"></i>
              {{uploadProgress.images}}
            </span>
            导入图片
          </label>

          <label class="btn btn-default"
                 ng-disabled="uploading.media">
            <input type="file" style="display:none;"
                   ng-file-select="onMediaSelect($files)"
                   multiple />
            <span ng-if="uploading.media">
              <i class="fa fa-spinner fa-spin"></i>
              {{uploadProgress.media}}
            </span>
            导入视频
          </label>
        </div>
      </div>

      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <button type="submit"
                  class="btn btn-default"
                  ng-click="saveLecture(lecture,form)">
            保存
          </button>
          <a class="btn btn-link"
             ui-sref="teacher.course({id:course._id})">
            <i class="fa fa-arrow-circle-o-left"></i>
            返回
          </a>
        </div>
      </div>
    </div>
  </form>
  <hr/>
  <div class="row">
    <div class="col-md-6 media">
      <div class="pull-left">
        <div class="list-group"
            style="
            -webkit-user-select: none;
            -user-select: none;
            -moz-user-select: none;
            position:relative;
            max-height: 320px;
            overflow: scroll;
            ">
          <a class="list-group-item stretch media-object"
              ng-class="{'active':slide.$active}"
              ng-click="slide.$active = true"
              ng-repeat-reorder="slide in lecture.slides"
              ng-repeat-reorder-handle="div.drag-point">
            <div class="drag-point fa fa-bars" draggable="true"></div>
            <img qiniu-key="slide.thumb"
                 suffix="?imageView2/2/w/40/h/40">
            <span ng-click="removeSlide($index)">
              <span class="glyphicon glyphicon-trash"></span>
            </span>
          </a>
        </div>
      </div>
      <div class="media-body">
        <cool-projector disable-animation="true">
          <cool-frame ng-repeat="slide in lecture.slides"
                      active="slide.$active">
            <img qiniu-key="slide.thumb"
                 suffix="?imageView2/2/w/500/h/500"
                 style="margin:auto;">
            <div class="carousel-caption">
              <h4>第 {{$index+1}} 张</h4>
            </div>
          </cool-frame>
        </cool-projector>
      </div>
    </div>
    <div class="col-md-6 col-xs-11" ng-show="lecture.media">
      <videogular vg-player-ready="onPlayerReady">
        <video class="videoPlayer" qiniu-key="lecture.media">
        </video>
        <vg-poster-image></vg-poster-image>
        <vg-buffering></vg-buffering>
        <vg-controls style="height: 50px;">
          <vg-play-pause-button></vg-play-pause-button>
          <vg-timeDisplay>{{ currentTime }}</vg-timeDisplay>
          <vg-scrubBar>
            <vg-scrubbarcurrenttime></vg-scrubbarcurrenttime>
          </vg-scrubBar>
          <vg-timeDisplay>{{ totalTime }}</vg-timeDisplay>
          <vg-volume>
            <vg-mutebutton></vg-mutebutton>
            <vg-volumebar></vg-volumebar>
          </vg-volume>
          <vg-fullscreenButton></vg-fullscreenButton>
        </vg-controls>
      </videogular>
      <a style="position: absolute; right: -.5em; top: .5em; z-index:999"
         ng-click="removeMedia()" >
        <span class="glyphicon glyphicon-remove"></span>
      </a>
    </div>
  </div>
  <hr/>
  <div class="row">
    <div class="list-group col-md-8 col-md-offset-2">
      <div class="input-group list-group-item-heading">
        <span class="input-group-addon">知识点</span>
        <input type="text"
               typeahead-on-select="addkeyPoint($item)"
               typeahead-input-formatter="keyPointFormatter($model)"
               ng-model="selectedKeyPoint"
               placeholder="查找并且添加知识点"
               typeahead="keyPoint as keyPoint.name for keyPoint in course.$keyPoints | filter:{name:$viewValue} | limitTo:8"
               class="form-control">
        <span class="input-group-btn">
          <button class="btn btn-default"
                  ng-click="addkeyPoint(selectedKeyPoint)">添加</button>
        </span>
      </div>
      <div class="list-group-item" ng-repeat="keyPoint in lecture.keyPoints">
        <a class="btn-link" ng-click="seekPlayerTime(keyPoint.timestamp)">
          <span class="glyphicon glyphicon-ok"></span>
          {{keyPoint.kp.name}}
        </a>
        <div class="pull-right">
          <a ng-click="removekeyPoint($index)" >
            <span class="glyphicon glyphicon-remove"></span>
          </a>
          <a ng-click="updatekeyPoint(keyPoint)" >
            <span class="glyphicon glyphicon-arrow-up"></span>
          </a>
          <input type="number"
                 ng-model="keyPoint.timestamp"
                 ng-blur="savekeyPoints()"/>
        </div>
      </div>
    </div>
  </div>
  <hr/>
  <div class="row">
    <div class="list-group col-md-8 col-md-offset-2">
      <div class="list-group-item-heading">
        <button class="btn btn-default"
                ng-click="addNewQuestion()">
          创建习题
        </button>
        <button class="btn btn-default"
                ng-click="addLibraryQuestion()">
          从习题库中添加
         </button>
      </div>
      <accordion>
        <accordion-group ng-repeat="question in lecture.homeworks">
          <accordion-heading >
            <div>
              <a class="btn-link">
                {{question.content.title}}
              </a>
              <a class="glyphicon glyphicon-trash pull-right"
                 ng-click="removeQuestion($index)">
              </a>
            </div>
          </accordion-heading>
          <ul class="nav nav-pills nav-stacked" role="tablist">
            <li ng-repeat="option in question.content.body"
                role="presentation">
              <a>
                <span>{{$index | indexToABC}}. </span>
                {{option.desc}}
                <span ng-class="{'pull-right glyphicon glyphicon-ok':option.correct}"></span>
              </a>
            </li>
            <li role="presentation">
              <div class="alert alert-warning">{{question.solution}}</div>
            </li>
          </ul>
        </accordion-group>
      </accordion>
    </div>
  </div>
  <hr/>
</div>

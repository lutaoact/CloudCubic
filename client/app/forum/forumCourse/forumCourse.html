<section>
  <div class="jumbotron bud">
    <div class="container">
      <h2>
        {{course.name}}
        <small><i class="fa fa-book"></i></small>
      </h2>
      <div>{{course.info}}</div>
    </div>
  </div>
</section>

<div class="container">

  <div class="clearfix title-row">
    <h4 class="pull-left">讨论区<i class="fa fa-comments-o base-color"></i></h4>
    <button class="bud btn btn-danger pull-right">
      <i class="fa fa-plus"></i>新讨论
    </button>
  </div>

  <div class="clearfix title-row">
    <div class="form-group pull-left col-xs-6 search">
      <div class="input-group">
        <div class="input-group-addon"><i class="fa fa-search"></i></div>
        <input class="form-control" type="text" placeholder="查询">
      </div>
    </div>
    <div class="pull-right">
      <div class="btn-group" dropdown is-open="status.isopen">
        <button type="button" class="btn dropdown-toggle">
          全部<span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li><a href="#">全部</a></li>
          <li><a href="#">我的帖子</a></li>
          <li><a href="#">我回复的</a></li>
        </ul>
      </div>
    </div>
  </div>

  <ul class="list-group topic-list" fix-when-reach-top fixed-class="fixed" offset="290">
    <div class="clearfix title-row">
      <h4 class="pull-left">主题</h4>
      <h5 class="pull-right">
        <small>排序</small>
        <i class="fa fa-clock-o" ng-click="sort('update')"></i>
        <i class="fa fa-heart" ng-click="sort('heat')"></i>
      </h5>
    </div>
    <li class="bud thumbnail media col-md-12 topic"
        ng-repeat="topic in topics"
        ng-class="{'selected':topic._id==selectedTopic._id}"
        >
      <div class="pull-left" href>
        <div class="media-object avatar-md"
             source-attr="background-image"
             src="http://placehold.it/32x32"
             src-key="topic.postBy.avatar"
             suffix="?imageView2/1/w/64/h/64">
        </div>
        <!-- <span>{{topic.postBy.name}}</span> -->
      </div>
      <div class="media-body" ng-click="viewTopic(topic)">
        <div class="pull-left">
          <strong>{{topic.title}}</strong>
          <div class="tags">
            <tag>第一课</tag><tag>牛顿一定律</tag>
          </div>
        </div>
      </div>
      <span class="badge">
        {{topic.replies||0}}
      </span>
    </li>
  </ul>

  <div class="topic-detail" ng-style="clientHeight">
    <div ng-show="selectedTopic">
      <div class="title-row" style="padding-top: 0.1px;">
        <h4>内容</h4>
      </div>
      <div class="bud article">

        <div class="article-header">
          <div class="article-header-left">
            <h3 class="article-title">{{selectedTopic.title}}
            </h3>
            <div class="post-time">{{selectedTopic.modified|date:'yyyy/MM/dd'}}</div>
            <div class="comment-count"><i class="fa fa-comments"></i>{{selectedTopic.replies||0}}</div>
          </div>
          <div class="article-header-right">
            <div class="media-object avatar-md"
                 source-attr="background-image"
                 suffix="?imageView2/1/w/64/h/64"
                 src-key="selectedTopic.postBy.avatar">
            </div>
            <h6 class="poster-name">{{selectedTopic.postBy.name}}</h6>
          </div>
        </div>

        <div class="article-body">
          <div class="blog" ng-bind-html="selectedTopic.$safeContent">
          </div>
        </div>
      </div>

      <hr>
      <div class="replies">
        <h5 class="base-color">{{selectedTopic.$replies.length||0}}个答复<small><i class="fa fa-comments"></i></small></h5>

        <div class="new-reply">
          <div class="new-reply-left">
            <div class="media-object avatar-sm"
                 source-attr="background-image"
                 src="http://placehold.it/32x32"
                 src-key="me.avatar"
                 suffix="?imageView2/1/w/64/h/64">
            </div>
          </div>
          <div class="new-reply-right" is-visible="viewState.newReplyVisible">
            <textarea
              id="new-reply"
              msd-elastic
              class="form-control reply-input"
              row="1"
              placeholder="请输入您要回复的内容..."
              ng-model="newReply.content"
              focus-me="viewState.newReplyVisible">
            </textarea>
            <div class="reply-tools">
              <div class="image-to-insert" ng-repeat="image in imagesToInsert">
                <img ng-src="{{image.url}}" alt="">
              </div>
              <uploader limit="2*1024*1024"
                        ng-disabled="replying"
                        class="new-img"
                        on-complete="onImgUploaded($data)"
                        accept="image">
                <i class="fa fa-photo"></i>
              </uploader>
            </div>
            <div>
              <button class="btn btn-danger btn-sm rounded submit pull-right" ng-click="replyTo(selectedTopic, newReply)">提交</button>
            </div>
          </div>
        </div>

        <ul class="list-group ">
          <li class="bud thumbnail media col-md-12 reply"
              ng-repeat="reply in selectedTopic.$replies">
            <a class="pull-left" href>
              <div class="media-object avatar-sm"
                   source-attr="background-image"
                   src="http://placehold.it/32x32"
                   src-key="reply.postBy.avatar"
                   suffix="?imageView2/1/w/64/h/64">
              </div>
            </a>
            <div class="media-body">

              <h5 class="base-color reply-author-name">{{reply.postBy.name}}<small>|</small><small>{{reply.created|timeToTimeAgo}}</small><a href ng-show="reply.postBy._id == me._id" class="pull-right">删除</a></h5>

              <div class="reply-body blog" ng-bind-html="reply.$safeContent"></div>
              <span class="pull-right">
                <a href="" class="btn vote">
                  <i
                    class="fa"
                    ng-class="{'fa-heart-o':reply.voteUpUsers.indexOf(me._id)<0,'fa-heart':reply.voteUpUsers.indexOf(me._id)>=0}"
                    ng-click="toggleVote(reply)">
                  </i>
                </a>
                {{reply.voteUpUsers.length||0}}个赞
              </span>
            </div>
          </li>
        </ul>

        <a class="btn form-control btn-primary btn-lg rounded"
          style="margin: 20px 0;border-radius: 3px; height: 49px;"
          href="#new-reply"
          du-smooth-scroll offset="200">
          快速回复该帖
        </a>
      </div>

    </div>
  </div>



  <section class="new-topic col-xs-12" style="display:none;">
    <div class="section-header">
      <h3>创建新的讨论</h3>
    </div>
    <div class="col-md-12">
      <input class="form-control"
             ng-model="myTopic.title"
             placeholder="标题"
             required>
    </div>
    <div class="col-md-12">
      <text-angular ng-model="myTopic.content"></text-angular>
    </div>
    <div class="col-md-4">
      <button class="btn btn-primary" ng-click="createTopic()">发表</button>
    </div>
  </section>

</div>


